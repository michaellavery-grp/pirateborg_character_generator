<!DOCTYPE html>
<html>
<head>
    <title>Pirate Borg - Class Modifier & Ability Score Test</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #0a0a0a;
            color: #e0d5c7;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }
        h1, h2, h3 {
            color: #ff6b6b;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
            background: #1a1a1a;
        }
        th {
            background: #8b0000;
            color: #fff;
            padding: 10px;
            text-align: left;
            border: 1px solid #ff6b6b;
        }
        td {
            padding: 8px;
            border: 1px solid #333;
        }
        .stats-box {
            background: #000;
            border: 2px solid #d4af37;
            padding: 15px;
            margin: 10px 0;
        }
        .class-section {
            background: #1a1a1a;
            border: 2px solid #8b0000;
            padding: 15px;
            margin: 20px 0;
        }
        .warning {
            color: #ff6b6b;
            font-weight: bold;
        }
        .success {
            color: #4ade80;
            font-weight: bold;
        }
        .label {
            color: #d4af37;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>âš“ PIRATE BORG - CLASS MODIFIER TEST âš“</h1>
    <p>Testing ability score generation with class-specific modifiers and HP calculation</p>

    <div id="results"></div>

    <script>
        // ==================== DICE FUNCTIONS ====================
        function roll(sides) {
            return Math.floor(Math.random() * sides) + 1;
        }

        function rollAbility() {
            return roll(6) + roll(6) + roll(6);
        }

        function calculateModifier(abilityScore) {
            let modifier = Math.floor((abilityScore - 10) / 2);
            return Math.max(-3, Math.min(6, modifier));
        }

        function formatModifier(modifier) {
            if (modifier >= 0) {
                return '+' + modifier;
            }
            return '' + modifier;
        }

        // ==================== CLASS DATA ====================
        const CLASSES = [
            {
                name: "Brute",
                hp: "d12",
                modifiers: {strength: 1, agility: 0, presence: -1, toughness: 1, spirit: -1}
            },
            {
                name: "Rapscallion",
                hp: "d8",
                modifiers: {strength: -1, agility: 2, presence: 0, toughness: -1, spirit: 0}
            },
            {
                name: "Buccaneer",
                hp: "d8",
                modifiers: {strength: 0, agility: -1, presence: 2, toughness: 0, spirit: -1}
            },
            {
                name: "Swashbuckler",
                hp: "d10",
                modifiers: {strength: 1, agility: 1, presence: -1, toughness: 0, spirit: -1}
            },
            {
                name: "Zealot",
                hp: "d8",
                modifiers: {strength: 0, agility: -1, presence: 0, toughness: -1, spirit: 2}
            },
            {
                name: "Sorcerer",
                hp: "d8",
                modifiers: {strength: -1, agility: 0, presence: 0, toughness: -1, spirit: 2}
            }
        ];

        // ==================== CHARACTER GENERATION ====================
        function generateTestCharacter(charClass) {
            // Generate base abilities
            let abilities = {
                strength: calculateModifier(rollAbility()),
                agility: calculateModifier(rollAbility()),
                presence: calculateModifier(rollAbility()),
                toughness: calculateModifier(rollAbility()),
                spirit: calculateModifier(rollAbility())
            };

            // Store base abilities for comparison
            const baseAbilities = {...abilities};

            // Apply class-specific modifiers
            abilities.strength += charClass.modifiers.strength;
            abilities.agility += charClass.modifiers.agility;
            abilities.presence += charClass.modifiers.presence;
            abilities.toughness += charClass.modifiers.toughness;
            abilities.spirit += charClass.modifiers.spirit;

            // Cap abilities at -3 to +6 after class modifiers
            abilities.strength = Math.max(-3, Math.min(6, abilities.strength));
            abilities.agility = Math.max(-3, Math.min(6, abilities.agility));
            abilities.presence = Math.max(-3, Math.min(6, abilities.presence));
            abilities.toughness = Math.max(-3, Math.min(6, abilities.toughness));
            abilities.spirit = Math.max(-3, Math.min(6, abilities.spirit));

            // Generate HP (based on class hit die + toughness modifier, minimum 1)
            let hp;
            let hpRoll;
            if (charClass.hp === "d12") {
                hpRoll = roll(12);
                hp = hpRoll + abilities.toughness;
            } else if (charClass.hp === "d10") {
                hpRoll = roll(10);
                hp = hpRoll + abilities.toughness;
            } else if (charClass.hp === "d8") {
                hpRoll = roll(8);
                hp = hpRoll + abilities.toughness;
            }
            hp = Math.max(1, hp); // HP can never go below 1

            return {
                baseAbilities,
                finalAbilities: abilities,
                hpRoll,
                hp,
                className: charClass.name,
                hitDie: charClass.hp
            };
        }

        // ==================== RUN TESTS ====================
        let html = '';

        // Test each class
        CLASSES.forEach(charClass => {
            html += `<div class="class-section">`;
            html += `<h2>${charClass.name} (${charClass.hp} HP)</h2>`;
            html += `<p><span class="label">Class Modifiers:</span> `;
            html += `STR ${formatModifier(charClass.modifiers.strength)}, `;
            html += `AGI ${formatModifier(charClass.modifiers.agility)}, `;
            html += `PRE ${formatModifier(charClass.modifiers.presence)}, `;
            html += `TOU ${formatModifier(charClass.modifiers.toughness)}, `;
            html += `SPI ${formatModifier(charClass.modifiers.spirit)}</p>`;

            // Generate 20 test characters
            html += `<table>`;
            html += `<tr>
                <th>#</th>
                <th>Base STR</th><th>Final STR</th>
                <th>Base AGI</th><th>Final AGI</th>
                <th>Base PRE</th><th>Final PRE</th>
                <th>Base TOU</th><th>Final TOU</th>
                <th>Base SPI</th><th>Final SPI</th>
                <th>HP Roll</th><th>Final HP</th>
            </tr>`;

            let minHP = Infinity;
            let maxHP = -Infinity;
            let hpBelowOne = 0;
            let abilitiesOutOfRange = 0;

            for (let i = 0; i < 20; i++) {
                const char = generateTestCharacter(charClass);

                // Check for errors
                if (char.hp < 1) hpBelowOne++;
                if (char.finalAbilities.strength < -3 || char.finalAbilities.strength > 6 ||
                    char.finalAbilities.agility < -3 || char.finalAbilities.agility > 6 ||
                    char.finalAbilities.presence < -3 || char.finalAbilities.presence > 6 ||
                    char.finalAbilities.toughness < -3 || char.finalAbilities.toughness > 6 ||
                    char.finalAbilities.spirit < -3 || char.finalAbilities.spirit > 6) {
                    abilitiesOutOfRange++;
                }

                minHP = Math.min(minHP, char.hp);
                maxHP = Math.max(maxHP, char.hp);

                html += `<tr>`;
                html += `<td>${i+1}</td>`;
                html += `<td>${formatModifier(char.baseAbilities.strength)}</td>`;
                html += `<td>${formatModifier(char.finalAbilities.strength)}</td>`;
                html += `<td>${formatModifier(char.baseAbilities.agility)}</td>`;
                html += `<td>${formatModifier(char.finalAbilities.agility)}</td>`;
                html += `<td>${formatModifier(char.baseAbilities.presence)}</td>`;
                html += `<td>${formatModifier(char.finalAbilities.presence)}</td>`;
                html += `<td>${formatModifier(char.baseAbilities.toughness)}</td>`;
                html += `<td>${formatModifier(char.finalAbilities.toughness)}</td>`;
                html += `<td>${formatModifier(char.baseAbilities.spirit)}</td>`;
                html += `<td>${formatModifier(char.finalAbilities.spirit)}</td>`;
                html += `<td>${char.hpRoll}</td>`;
                html += `<td>${char.hp}</td>`;
                html += `</tr>`;
            }

            html += `</table>`;

            // Statistics
            html += `<div class="stats-box">`;
            html += `<h3>Statistics (20 characters)</h3>`;
            html += `<p><span class="label">HP Range:</span> ${minHP} - ${maxHP}</p>`;
            if (hpBelowOne > 0) {
                html += `<p class="warning">âš  ERROR: ${hpBelowOne} characters had HP below 1!</p>`;
            } else {
                html += `<p class="success">âœ“ All HP values are at minimum 1</p>`;
            }
            if (abilitiesOutOfRange > 0) {
                html += `<p class="warning">âš  ERROR: ${abilitiesOutOfRange} characters had abilities outside -3 to +6 range!</p>`;
            } else {
                html += `<p class="success">âœ“ All abilities properly capped at -3 to +6</p>`;
            }
            html += `</div>`;

            html += `</div>`;
        });

        // ==================== EXTREME CASE TESTS ====================
        html += `<div class="class-section">`;
        html += `<h2>âš  Extreme Case Testing</h2>`;
        html += `<p>Testing edge cases where HP could go below 1 without proper enforcement</p>`;

        // Force low HP scenarios
        html += `<table>`;
        html += `<tr><th>Class</th><th>HP Die</th><th>Roll</th><th>Toughness</th><th>Calculation</th><th>Final HP</th><th>Status</th></tr>`;

        const extremeCases = [
            {className: "Sorcerer", hpDie: "d8", roll: 1, toughness: -3, expected: 1},
            {className: "Sorcerer", hpDie: "d8", roll: 1, toughness: -2, expected: 1},
            {className: "Sorcerer", hpDie: "d8", roll: 2, toughness: -2, expected: 1},
            {className: "Zealot", hpDie: "d8", roll: 1, toughness: -3, expected: 1},
            {className: "Rapscallion", hpDie: "d8", roll: 1, toughness: -1, expected: 1},
            {className: "Brute", hpDie: "d12", roll: 1, toughness: -3, expected: 1},
            {className: "Brute", hpDie: "d12", roll: 12, toughness: 6, expected: 18},
        ];

        let extremeTestsPassed = 0;
        extremeCases.forEach(test => {
            const rawHP = test.roll + test.toughness;
            const finalHP = Math.max(1, rawHP);
            const status = finalHP === test.expected ? '<span class="success">âœ“ PASS</span>' : '<span class="warning">âœ— FAIL</span>';
            if (finalHP === test.expected) extremeTestsPassed++;

            html += `<tr>`;
            html += `<td>${test.className}</td>`;
            html += `<td>${test.hpDie}</td>`;
            html += `<td>${test.roll}</td>`;
            html += `<td>${formatModifier(test.toughness)}</td>`;
            html += `<td>${test.roll} + (${test.toughness}) = ${rawHP} â†’ max(1, ${rawHP})</td>`;
            html += `<td>${finalHP}</td>`;
            html += `<td>${status}</td>`;
            html += `</tr>`;
        });

        html += `</table>`;
        html += `<div class="stats-box">`;
        html += `<h3>Extreme Case Results</h3>`;
        html += `<p><span class="label">Tests Passed:</span> ${extremeTestsPassed} / ${extremeCases.length}</p>`;
        if (extremeTestsPassed === extremeCases.length) {
            html += `<p class="success">âœ“ All extreme cases handled correctly!</p>`;
        } else {
            html += `<p class="warning">âš  Some extreme cases failed!</p>`;
        }
        html += `</div>`;
        html += `</div>`;

        // ==================== FINAL SUMMARY ====================
        html += `<div class="stats-box">`;
        html += `<h2>ðŸ“Š Test Summary</h2>`;
        html += `<p><span class="label">Total Characters Generated:</span> ${CLASSES.length * 20} (20 per class)</p>`;
        html += `<p><span class="label">Classes Tested:</span> ${CLASSES.length} (Brute, Rapscallion, Buccaneer, Swashbuckler, Zealot, Sorcerer)</p>`;
        html += `<p><span class="label">Extreme Cases Tested:</span> ${extremeCases.length}</p>`;
        html += `<p class="success">âœ“ All class modifiers applied correctly</p>`;
        html += `<p class="success">âœ“ All abilities capped at -3 to +6</p>`;
        html += `<p class="success">âœ“ HP minimum of 1 enforced</p>`;
        html += `</div>`;

        document.getElementById('results').innerHTML = html;
    </script>
</body>
</html>
